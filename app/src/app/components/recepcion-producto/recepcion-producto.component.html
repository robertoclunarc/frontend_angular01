<!-- <p-toast [style]="{'position': 'center', 'overflow': 'visible', 'z-index': '999'}" position="top-center" key="tc">
</p-toast> -->
<p-toast [style]="{marginTop: '80px'}" position="top-center" key="tc"></p-toast>
<p-confirmDialog #cd header="Confirmation" icon="pi pi-exclamation-triangle">
    <p-footer>
        <button type="button" pButton icon="pi pi-check" label="Si" (click)="cd.accept()"></button>
        <button type="button" pButton icon="pi pi-times" label="Cancelar" (click)="cd.reject()"></button>
    </p-footer>
</p-confirmDialog>


<div class="container-fluid">
    <div class="card mb-3">
        <h4 class="card-header">Recepcion de Productos</h4>
        <!--       
        <div class="card-body" [ngClass]="'bodyCardFondo'">
            <div class="container-fluid">
                <div class="row">
                    <div class=" col-sm-2 text-center">
                        <div [ngStyle]="{'background-color': '#191919'}">
                            <label class="" placeholder="Numero orden de compra" style="width:180px;height:27px;text-align:center; padding-top: 5px;">N° Orden de Compra</label>
                        </div>
                    </div>
                    <div class="col-sm-3" class="text-center">
                        <div><input pInputText type="text" pTooltip="Ingrese numero Orden de Compra" tooltipPosition="bottom"  placeholder="# Orden de Compra" size="15" style="width:180px;height:33px;text-align:center" [(ngModel)]="codigo"></div>
                    </div>
                    <div class="col-sm-6">
                        <button pButton type="button" label="Buscar"
                        (click)="ObtenerDetallesOc(codigo)" pButton icon="fa fa-search" style="width:180px; height:33px; text-align:center; margin-right: .1em"></button>
                    </div>
                </div>
            </div>            
        </div>
        -->
        <app-oc-master [idOc]="idOC"></app-oc-master>
        <div class="container-fluid">
            
            <h5 class="card-header">Detalles:</h5>
            <div class="row">
                <div class=" col-sm-6 text-left">
                 <h4></h4>
                </div> 
            <div class="card-body">
                <p-table [value]="detallesOc" dataKey="codigo" editMode="row">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Codigo</th>
                            <th>Nombre</th>
                            <th>Descripcion</th>
                            <th style="width:8em">Cantidad</th>
                            <th>Unidad de Medida</th>
                            <th style="width:8em">Recibido</th>
                            <th style="width:8em">Conforme</th>
                            <th>Ubicación</th>
                            <th>Observaciones</th>
                            <!--<th style="width:8em"></th>-->
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex">
                        <tr [pEditableRow]="rowData">
                            <td>{{rowData.codigo}}</td>
                            <td>{{rowData.nombre}}</td>
                            <td>{{rowData.descripcion}}</td>
                            <td>{{rowData.cant_encontrada}}</td>
                            <td>{{rowData.unidadMedidaNombre}}</td>
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input id=ri pInputText type="text" size="6" placeholder="Recibido" [(ngModel)]="rowData.cant_recibido" required>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{rowData.cant_recibido}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input pInputText type="text" placeholder="Conforme"  size="6" [(ngModel)]="rowData.cant_conforme" required>
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{rowData.cant_conforme}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <td>{{rowData.codigoPuesto}}</td>
                            <td>
                                <p-cellEditor>
                                    <ng-template pTemplate="input">
                                        <input pInputText type="text" placeholder="Observaciones" size="10" [(ngModel)]="rowData.notas">
                                    </ng-template>
                                    <ng-template pTemplate="output">
                                        {{rowData.notas}}
                                    </ng-template>
                                </p-cellEditor>
                            </td>
                            <!--<td style="text-align:center">-->
                               <!-- <button *ngIf="!editing" pButton type="button" pInitEditableRow icon="pi pi-pencil" class="ui-button-info" (click)="onRowEditInit(rowData, ri, $event)" [disabled]="isdisabled"></button>-->
                               <!-- <button *ngIf="editing" id="{{ri + 'boton'}}" pButton type="button" pSaveEditableRow icon="pi pi-list" class="ui-button-success" style="margin-right: .5em" [disabled]="readOnly" (click)="onRowEditSave()"></button>-->
                               <!-- <button *ngIf="editing" pButton type="button" pCancelEditableRow icon="pi pi-times" class="ui-button-danger" (click)="onRowEditCancel(rowData, ri, $event)"></button>-->
                            <!--</td>-->
                        </tr>
                        <tr>
                            <td colspan="9">
                            <div>
                                <p-accordion [multiple]="true">
                                    <p-accordionTab header="Recepcion de Productos">
                                        <ng-template pTemplate="summary" >
                                            <footer class="card-footer">
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div style="text-align:center">
                                                            <button style="width:20%" type="button" pButton icon="fa fa-plus"
                                                                (click)="showDialogToAdd(rowData)" label="Nuevo Mov."></button>
                                                            
                                                        </div>
                                                    </div>
                                                </div>
                                            </footer>
                                        </ng-template>
                                        <div class="container-fluid">
                                            <div class="row">
                            
                                                <div class="col-12 col-sm-2 text-center"
                                                    [ngStyle]="{'background-color': '#191919'}">
                                                    <label class="">Fecha Registro</label>
                                                </div>
                                                <div class="col-12 col-sm-1 text-center"
                                                    [ngStyle]="{'background-color': '#191919'}">
                                                    <label class="">Tipo</label>
                                                </div>
                                                <div class="col-12 col-sm-1 text-center"
                                                    [ngStyle]="{'background-color': '#191919'}">
                                                    <label class="">Entrada</label>
                                                </div>
                                                <div class="col-12 col-sm-1 text-center"
                                                    [ngStyle]="{'background-color': '#191919'}">
                                                    <label class="">Salida</label>
                                                </div>
                                                <div class="col-12 col-sm-4 text-center"
                                                    [ngStyle]="{'background-color': '#191919'}">
                                                    <label class="">Justificacion</label>
                                                </div>
                                                <div class="col-12 col-sm-1 text-center"
                                                    [ngStyle]="{'background-color': '#191919'}">
                                                    <label class="">Estatus</label>
                                                </div>
                                                <div class="col-12 col-sm-1 text-center"
                                                    [ngStyle]="{'background-color': '#191919'}">
                                                    <label class="">User</label>
                                                </div>
                                                
                                                <div class="col-12 col-sm-1 text-center"
                                                    [ngStyle]="{'background-color': '#191919'}">
                                                    <label class="">Acciones</label>
                                                </div>
                                                
                                            </div>
                                            <div class="row" *ngFor="let MOV of recepciones; let index = index">
                                                <ng-container *ngIf="MOV.id_producto == rowData.idProducto">
                                                    <div class="col-12 col-sm-2 border-bottom border-light text-center"
                                                        [ngStyle]="{'background-color': '#454545'}">
                                                        <label class="">{{MOV.fecha_solicitud | date:'dd/MM/yyyy'}}</label>
                                                    </div>
                                                    <div class="col-12 col-sm-1 border-bottom border-light text-center"
                                                        [ngStyle]="{'background-color': '#454545'}">
                                                        <label class="">{{MOV.tipo}}</label>
                                                    </div>
                                                    <div class="col-12 col-sm-1 border-bottom border-light text-center"
                                                        [ngStyle]="{'background-color': '#454545'}">
                                                        <label class="" style="font-size: 0.75rem;">{{MOV.entrada}}</label>
                                                    </div>
                                                    <div class="col-12 col-sm-1 border-bottom border-light text-center"
                                                        [ngStyle]="{'background-color': '#454545'}">
                                                        <label class="">{{MOV.salida}}</label>
                                                    </div>
                                                    <div class="col-12 col-sm-4 border-bottom border-light text-center"
                                                        [ngStyle]="{'background-color': '#454545'}">
                                                        <label class="">{{MOV.justificacion}}</label>
                                                    </div>
                                                    <div class="col-12 col-sm-1 border-bottom border-light text-center"
                                                        [ngStyle]="{'background-color': '#454545'}">
                                                        <label class="">{{MOV.estatus}}</label>
                                                    </div>
                                                    <div class="col-12 col-sm-1 border-bottom border-light text-center"
                                                        [ngStyle]="{'background-color': '#454545'}">
                                                        <label class="">{{MOV.id_usuario_proceso}}</label>
                                                    </div>
                                                    <div class="col-12 col-sm-1 border-bottom border-light text-center"
                                                        [ngStyle]="{'background-color': '#454545'}">
                                                        <button pButton type="button" icon="pi pi-list" class="ui-button-success"
                                                            (click)="update(MOV)" pTooltip="Procesar Mov." style="margin-right: .1em"></button>	
                                                    </div>
                                                    
                                                    <!--
                                                    <div class="col-12 col-sm-1 border-bottom border-light text-center py-2"
                                                                [ngStyle]="{'background-color': '#454545'}">                                                            
                                                                <button pButton type="button" icon="pi pi-list"
                                                                    pTooltip="Cambiar Estatus" tooltipPosition="top"
                                                                    class="ui-button-success" 
                                                                    style="margin-right: .1em">                                                    
                                                                </button>
                                                    </div>
                                                    -->
                                                </ng-container>    
                                            </div>                                 
                                        </div>
                                        <br>
                                    </p-accordionTab>
                                </p-accordion>                    
                            </div>
                        </td>
                        </tr>
                    </ng-template>

                
          <!--              <td>
                            <input id="{{'rec' + rowData.codigo}}"  type="text" placeholder="Recibido" size="10"  [(ngModel)]="rowData.cant_recibido">
                        </td>
                        <td>
                            <input id="{{'com' + rowData.codigo}}"  type="text" placeholder="Conforme"  size="10" #box (keyup.enter)="onRowEditInit(rowData)" [(ngModel)]="rowData.cant_conforme">
                        </td>
                
                        <td>
                            <input  id="{{'obs' + rowData.codigo}}" type="text" placeholder="Observaciones" size="10" [(ngModel)]="rowData.Observaciones" [readonly]="true">
                        </td> -->
                
                         
                
                
                    
                   <!--  <div style="text-align:right">
                      <button pButton type="button" label="Procesar" icon="pi pi-check" iconPos="left" class="ui-button-success"
                        (click)="procesar()"></button>  
                    </div>  -->

                   <!-- <ng-template pTemplate="summary" let-rowData>
                        <div class="row">
                            <div style="text-align:right">
                                <button pButton type="button" label="Anular" class="ui-button-primary float margin-right"
                                    (click)="anular()">
                                </button>  
                            </div>     
                            &nbsp;&nbsp;
                            <div style="text-align:right">
                                <button pButton type="button" label="Procesar" icon="pi pi-check" iconPos="left" class="ui-button-success float margin-right"
                                    (click)="procesar()" [disabled]="isdisabled">
                                </button>  
                            </div> 
                        </div>
                    </ng-template>
                      -->  
                </p-table>
           
            </div>           
        </div> 
    </div>      
</div>

<ng-container *ngIf="displayDialog">
	<p-dialog [(header)]="tituloDialogo" [contentStyle]="{'overflow':'visible'}" [(visible)]="displayDialog"
		[responsive]="true" showEffect="fade" onHide="cerrar()" [closable]="true" position="50" [modal]="true" [style]="{width: '70vw'}" [positionTop]="50" width="700">
		<div class="ui-g ui-fluid">
            <div class="ui-g-1">
				<label class="">Tipo</label>
			</div>
            <div class="ui-g-5">               
                <p-dropdown [options]="tiposMovimientos" [(ngModel)]="tipo" placeholder="Seleccione Tipo Mov."
                          [filter]="false"></p-dropdown>
            </div>
            <div class="ui-g-1">
				<label class="">Puesto</label>
			</div>
            <div class="ui-g-5">
                <p-dropdown  [options]="puesto" [(ngModel)]="nuevoMovimiento.id_puesto" 
                  [filter]="true" placeholder="Seleccione Puesto" ></p-dropdown>
            </div>
        </div>

        <div class="ui-g ui-fluid">	
            <div class="ui-g-1">
				<label class="">Entrada</label>
			</div>		
			<div class="ui-g-5">
				<input type="number" pInputText  id="entrada" [(ngModel)]="nuevoMovimiento.entrada"  placeholder="Cantidad Entrada" />
			</div>
            <div class="ui-g-1">
				<label class="">Salida</label>
			</div>
            <div class="ui-g-5">
				<input type="number" pInputText id="salida" [(ngModel)]="nuevoMovimiento.salida"  placeholder="Cantidad Salida" />
			</div>
				
		</div>	

		<div class="ui-g ui-fluid">
            <div class="ui-g-1">
				<label class="">Origen</label>
			</div>
            <div class="ui-g-5">
                <p-dropdown  [options]="almacenes" [(ngModel)]="nuevoMovimiento.id_almacen_origen" 
                  [filter]="true" placeholder="Seleccione Origen" >
                    
                </p-dropdown>
            </div>
            <div class="ui-g-1">
				<label class="">Destino</label>
			</div>
			<div class="ui-g-5">
                <p-dropdown  [options]="almacenes" [(ngModel)]="nuevoMovimiento.id_almacen_destino" 
                 [filter]="true" placeholder="Seleccione Destino" ></p-dropdown>
            </div>
        </div>		
		
		<div class="ui-g ui-fluid">	
            <div class="ui-g-1">
				<label class="">Costo</label>
			</div>		
			<div class="ui-g-5">
				<input pInputText type="number" readonly id="costo" [(ngModel)]="nuevoMovimiento.costo"  placeholder="Costo" />
			</div>
            <div class="ui-g-1">
				<label class="">Lote</label>
			</div>
            <div class="ui-g-5">
				<input pInputText id="lote" [(ngModel)]="nuevoMovimiento.lote"  placeholder="Lote" />
			</div>
				
		</div>
		
        
        <div class="ui-g ui-fluid">
            <div class="ui-g-1">
				<label class="">Justificacion</label>
			</div>
            <div class="ui-g-11">
                <textarea pInputText id="justificacion" [(ngModel)]="nuevoMovimiento.justificacion"  placeholder="Justificacion" rows="3"></textarea>
            </div>
        </div>
        <div class="ui-g ui-fluid">	
            <div class="ui-g-1">
				<label class="">Caducidad</label>
			</div>		
            <div class="ui-g-5">
				<p-calendar [(ngModel)]="nuevoMovimiento.fecha_caducidad" placeholder="Fecha Caducidad"  readonlyInput="true" [showIcon]="true">
                </p-calendar>
			</div>
            <div class="ui-g-1">
				<label class="">Aprobacion</label>
			</div>		
            <div class="ui-g-5">
				<input pInputText id="fecha_aprobacion" [(ngModel)]="nuevoMovimiento.fecha_aprobacion"  placeholder="Fecha Aprobacion"  readonly />
                
			</div>
				
		</div>
        
        <div class="ui-g ui-fluid">
            <div class="ui-g-1">
				<label class="">Estatus</label>
			</div>
            <div class="ui-g-5">
                <p-dropdown [options]="estatusNuevo"  [(ngModel)]="nuevoMovimiento.estatus" placeholder="Seleccione Estatus" > </p-dropdown>
            </div>
			<div class="ui-g-1">
				<label class="">logico</label>
			</div>
            <div class="ui-g-5">
                <p-inputSwitch [(ngModel)]="nuevoMovimiento.es_logico"   (onChange)="handleChange($event, nuevoMovimiento)" >
                </p-inputSwitch>
            </div>
        </div>
		<p-footer>
			<div class="ui-dialog-buttonpane ui-helper-clearfix">
				<button type="button" pButton icon="fa fa-check"  (click)="guardar()"  label="Guardar"></button>
				<button type="button" pButton icon="fa fa-times" (click)="cerrar()"  label="Cerrar"></button>
			</div>
		</p-footer>
	</p-dialog>
</ng-container>